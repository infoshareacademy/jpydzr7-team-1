<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel uÅ¼ytkownika</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

{% if user.is_authenticated %}
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'dashboard' %}">BudgetApp</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="PrzeÅ‚Ä…cz nawigacjÄ™">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav gap-2 mx-auto">
        <!-- tutaj moÅ¼esz dodaÄ‡ linki menu -->
      </ul>
      <div class="ms-auto">
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button class="btn btn-outline-danger btn-sm mt-1" type="submit">Wyloguj siÄ™</button>
        </form>
      </div>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <div class="row">
    <!-- Karta 1: Dane uÅ¼ytkownika -->
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <h5 class="card-title">Dane uÅ¼ytkownika</h5>
            <p><strong>ImiÄ™:</strong> {{ profile_user.name }}</p>
            <p><strong>Nazwisko:</strong> {{ profile_user.surname }}</p>
            <p><strong>Email:</strong> {{ profile_user.email }}</p>
            <p><strong>Login:</strong> {{ profile_user.login }}</p>
            {% if profile_user.family %}
              <p><strong>Rodzina:</strong> {{ profile_user.family.family_name }}</p>
              <p><strong>ID rodziny:</strong> {{ family_id }}</p>
            {% endif %}
            {% if profile_user.parent %}
              <p><strong>Rodzic:</strong> {{ profile_user.parent.name }} {{ profile_user.parent.surname }}</p>
            {% endif %}
          </div>
          <div class="d-flex justify-content-end">
            <a href="{% url 'delete_account' %}" class="btn btn-success mt-3 me-3">ğŸ—‘ UsuÅ„ konto</a>
            <a href="{% url 'password_change' %}" class="btn btn-success mt-3">ZmieÅ„ hasÅ‚o</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Karta 2: CzÅ‚onkowie rodziny -->
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <h5 class="card-title">CzÅ‚onkowie rodziny</h5>
            <ul class="list-group list-group-flush">
              {% for member in family_members %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    {{ member.name }} {{ member.surname }} ({{ member.login }})
                  </div>

                  {% if member.user_id and user.role == "adult" and member.role == "kid" and member.parent and member.parent.user_id == user.user_id %}
                    <form method="post" action="{% if member.is_blocked %}{% url 'unblock_kid' member.user_id %}{% else %}{% url 'block_kid' member.user_id %}{% endif %}">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm {% if member.is_blocked %}btn-success{% else %}btn-danger{% endif %}">
                        {% if member.is_blocked %}Odblokuj{% else %}Zablokuj{% endif %}
                      </button>
                    </form>
                  {% endif %}
                </li>
              {% empty %}
                <li class="list-group-item">Brak innych czÅ‚onkÃ³w rodziny.</li>
              {% endfor %}
            </ul>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-3">
            {% if not profile_user.family %}
              <a href="{% url 'create_family' %}" class="btn btn-primary">â• UtwÃ³rz rodzinÄ™</a>
            {% elif user.role == "adult" %}
              <a href="{% url 'invitation' %}" class="btn btn-success">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ZaproÅ› do rodziny</a>
              <a href="{% url 'create_kid' %}" class="btn btn-success">ğŸ‘¶ UtwÃ³rz konto dla dziecka</a>
            {% endif %}
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

{% else %}
<div class="container mt-5">
  <div class="alert alert-warning text-center">
    <h4>Zaloguj siÄ™, aby zobaczyÄ‡ swÃ³j panel uÅ¼ytkownika.</h4>
    <a href="{% url 'login' %}" class="btn btn-primary mt-3">Zaloguj siÄ™</a>
  </div>
</div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
