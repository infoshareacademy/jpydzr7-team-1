<!DOCTYPE html>
{% load static %}
<html>
<head>
  <title>Interaktywne wykresy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .chart-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 0px;
      gap: 20px;
    }

    .chart-container {
      min-width: 400px;
      max-width: 400px;
      padding-top: 0;
      padding-bottom: 0;
    }

    .date-filter-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .date-form {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .chart-title {
      line-height: 1.2;
      margin-bottom: 10px;
      padding-left: 30px;  /* Przesunięcie w lewo */
    }
  </style>
</head>
<body>
  {% include 'navbar.html' %}

  <div class="date-filter-container">
    <form method="get" class="date-form">
      <label>Od: <input type="date" name="start_date" value="{{ start_date }}"></label>
      <label>Do: <input type="date" name="end_date" value="{{ end_date }}"></label>
      <button type="submit" class="btn btn-primary">Filtruj</button>
    </form>
  </div>

  <div class="chart-row">


    <div class="chart-container">
      <h3 class="chart-title">Przychody</h3>
      <canvas id="incomeChart"></canvas>
    </div>

    <div class="chart-container">
      <h3 class="chart-title">Wydatki</h3>
      <canvas id="expenseChart"></canvas>
    </div>

  </div>

  <div class="container mt-5">
    <h3 class="text-center">Przychody i Wydatki w czasie</h3>
    <canvas id="timelineChart" height="100"></canvas>
  </div>

  <script>
    const expenseLabels = {{ expense_labels|safe }};
    const expenseValues = {{ expense_values|safe }};
    const incomeLabels = {{ income_labels|safe }};
    const incomeValues = {{ income_values|safe }};

    // Funkcja generująca losowe kolory
    function generateColors(length) {
      const colors = [];
      for (let i = 0; i < length; i++) {
        const r = Math.floor(Math.random() * 200 + 30);
        const g = Math.floor(Math.random() * 200 + 30);
        const b = Math.floor(Math.random() * 200 + 30);
        colors.push(`rgba(${r}, ${g}, ${b}, 0.6)`);
      }
      return colors;
    }

    // Wykres wydatków
    new Chart(document.getElementById('expenseChart').getContext('2d'), {
      type: 'pie',
      data: {
        labels: expenseLabels,
        datasets: [{
          data: expenseValues,
          backgroundColor: generateColors(expenseLabels.length),
          borderColor: 'rgba(255, 255, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'right' },
          tooltip: { enabled: true }
        }
      }
    });

    // Wykres przychodów
    new Chart(document.getElementById('incomeChart').getContext('2d'), {
      type: 'pie',
      data: {
        labels: incomeLabels,
        datasets: [{
          data: incomeValues,
          backgroundColor: generateColors(incomeLabels.length),
          borderColor: 'rgba(255, 255, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'right' },
          tooltip: { enabled: true }
        }
      }
    });

    // Dane do wykresu liniowego
    const timelineLabels = {{ timeline_dates|safe }};
    const timelineIncome = {{ timeline_incomes|safe }};
    const timelineExpense = {{ timeline_expenses|safe }};

    // Wykres liniowy
    new Chart(document.getElementById('timelineChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: timelineLabels,
        datasets: [
          {
            label: 'Przychody',
            data: timelineIncome,
            borderColor: 'green',
            backgroundColor: 'rgba(0,255,0,0.1)',
            tension: 0.3
          },
          {
            label: 'Wydatki',
            data: timelineExpense,
            borderColor: 'red',
            backgroundColor: 'rgba(255,0,0,0.1)',
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          tooltip: { enabled: true }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Kwota (PLN)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Data'
            }
          }
        }
      }
    });
  </script>
</body>
</html>