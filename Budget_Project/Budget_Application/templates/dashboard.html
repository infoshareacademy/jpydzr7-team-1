<!DOCTYPE html>
{% load static %}
<html>
<head>
  <title>Interaktywne wykresy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
.chart-row {
  display: flex;
  justify-content: center;  /* lub 'flex-start' */
  flex-wrap: wrap;
  margin-top: 0px;
  gap: 20px; /* Dodajemy kontrolowany odstęp między wykresami */
}

.chart-container {
  min-width: 400px;
  max-width: 400px;
  padding-top: 0;
  padding-bottom: 0;
}
.date-filter-container {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}

.date-form {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap; /* Żeby wyglądało dobrze na telefonie */
}
.chart-title {
  line-height: 1.2;
}

  </style>
</head>
<body>
  {% include 'navbar.html' %}
<div class="date-filter-container">
  <form method="get" class="date-form">
    <label>Od: <input type="date" name="start_date" value="{{ start_date }}"></label>
    <label>Do: <input type="date" name="end_date" value="{{ end_date }}"></label>
    <button type="submit" class="btn btn-primary">Filtruj</button>
  </form>
</div>
<div class="chart-row">
  <div class="chart-container">
    <h3 class="chart-title">Wydatki</h3>
    <canvas id="expenseChart"></canvas>
  </div>

  <div class="chart-container">
    <h3 class="chart-title">Przychody</h3>
    <canvas id="incomeChart"></canvas>
  </div>
</div>
<div class="container mt-5">
  <h3 class="text-center">Przychody i Wydatki w czasie</h3>
  <canvas id="timelineChart" height="100"></canvas>
</div>
  <script>
    // Dane do wydatków (expense)
    const expenseLabels = {{ expense_labels|safe }};
    const expenseValues = {{ expense_values|safe }};

    // Dane do przychodów (income)
    const incomeLabels = {{ income_labels|safe }};
    const incomeValues = {{ income_values|safe }};

    // Konfiguracja wykresu wydatków
    const ctxExpense = document.getElementById('expenseChart').getContext('2d');
    const expenseChart = new Chart(ctxExpense, {
      type: 'pie',
      data: {
        labels: expenseLabels,
        datasets: [{
          data: expenseValues,
          backgroundColor: [
            'rgba(255, 99, 132, 0.6)',
            'rgba(54, 162, 235, 0.6)',
            'rgba(255, 206, 86, 0.6)',
            'rgba(75, 192, 192, 0.6)',
          ],
          borderColor: 'rgba(255, 255, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'right' },
          tooltip: { enabled: true }
        }
      }
    });

    // Konfiguracja wykresu przychodów
    const ctxIncome = document.getElementById('incomeChart').getContext('2d');
    const incomeChart = new Chart(ctxIncome, {
      type: 'pie',
      data: {
        labels: incomeLabels,
        datasets: [{
          data: incomeValues,
          backgroundColor: [
            'rgba(255, 159, 64, 0.6)',
            'rgba(153, 102, 255, 0.6)',
            'rgba(255, 205, 86, 0.6)',
            'rgba(201, 203, 207, 0.6)',
          ],
          borderColor: 'rgba(255, 255, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'right' },
          tooltip: { enabled: true }
        }
      }
    });
        // Dane do wykresu liniowego
    const timelineLabels = {{ timeline_dates|safe }};
    const timelineIncome = {{ timeline_incomes|safe }};
    const timelineExpense = {{ timeline_expenses|safe }};

    // Wykres liniowy przychody vs wydatki w czasie
    const ctxTimeline = document.getElementById('timelineChart').getContext('2d');
    const timelineChart = new Chart(ctxTimeline, {
      type: 'line',
      data: {
        labels: timelineLabels,
        datasets: [
          {
            label: 'Przychody',
            data: timelineIncome,
            borderColor: 'green',
            backgroundColor: 'rgba(0,255,0,0.1)',
            tension: 0.3
          },
          {
            label: 'Wydatki',
            data: timelineExpense,
            borderColor: 'red',
            backgroundColor: 'rgba(255,0,0,0.1)',
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          tooltip: { enabled: true }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Kwota (PLN)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Data'
            }
          }
        }
      }
    });

  </script>
</body>
</html>
